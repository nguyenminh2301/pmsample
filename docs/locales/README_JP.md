# 予後研究のためのサンプルサイズ推定 (Prognostic Research Sample Size Tool)

[![Streamlit App](https://static.streamlit.io/badges/streamlit_badge_black_white.svg)](https://pmsample.streamlit.app/)
[![Python 3.9+](https://img.shields.io/badge/python-3.9%2B-blue.svg)](https://www.python.org/downloads/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

臨床予後研究における最小サンプルサイズを計算するためのツールキットです。データサイエンティスト、統計学者、臨床研究者向けに設計されており、**予測モデル開発**、**外部検証**、**予後因子研究**、**モデル更新**のための検証済みの統計手法を実装しています。

🔗 **アプリにアクセス:** [https://pmsample.streamlit.app/](https://pmsample.streamlit.app/)

> **注意**: 本アプリの中国語、日本語、フランス語、ドイツ語のコンテンツの一部はAIによって翻訳されています。ご不明な点がございましたら、アプリ管理者までお問い合わせください。

---

## 1. 概要と目的

本アプリは、医学研究におけるサンプルサイズ計画の複雑な要件に対処するための一連のツールを提供します。基本的な検出力計算機とは異なり、このツールは*予後モデリング*の特定のニュアンスに焦点を当てており、単純な仮説検定ではなく、リスクの正確な推定（キャリブレーションと識別能）を目標とすることがよくあります。

### 主な機能

* **方法論的厳密さ**: 査読付き統計文献 (Riley et al., Hanley & McNeil, Hsieh, et al.) に厳密に準拠したアルゴリズムを実装しています。
* **検証 (Validation)**: コア計算は、正確性を保証するために信頼できるRパッケージ (`pmsampsize`, `presize`, `pmvalsampsize`, `sampsizeval`) と照合されています。
* **多言語サポート**: 英語とベトナム語を完全にサポートし、中国語、日本語、フランス語、ドイツ語も部分的にサポートしており、国際協力を促進します。
* **感度分析**: 統合されたバッチ処理により、研究者はさまざまな仮定（例：有病率や予想される $R^2$ の変化）にわたってサンプルサイズ要件がどのように変化するかを評価できます。

---

## 2. メソッドカタログ

アプリは4つの主要モジュールに構成されており、それぞれが研究サイクルの特定のフェーズを対象としています。

### A. 予備的実現可能性評価

| 方法 | 説明 | 適用シナリオ |
| :--- | :--- | :--- |
| **A1: イベント対変数比 (EPV/EPP)** | イベント数と候補予測パラメータ数の比に基づく経験則。 | *実現可能性の確認のみ。* 過学習やキャリブレーションを考慮していないため、研究プロトコルの**主要な根拠とすることは推奨されません**。 |
| **A2: ベースラインリスクの精度** | 指定された信頼区間 (CI) 幅で有病率を推定するために必要なサンプルサイズを推定します。 | 記述疫学; 全体的なキャリブレーション (calibration-in-the-large) の計画。 |

### B. 予後因子研究 (関連性)

| 方法 | 説明 | 参考文献 |
| :--- | :--- | :--- |
| **B3: ロジスティック回帰の検出力** | 他の因子との共分散を調整し、特定の予測変数の目標オッズ比 (OR) を検出するためのサンプルサイズを計算します。 | **Hsieh et al. (1998)** |
| **B4: Cox 回帰の検出力** | 生存分析において目標ハザード比 (HR) を検出するために必要なイベント数を計算します。 | **Schoenfeld (1983)** |

### C. 予測モデル開発 (推奨)

これは、新しい臨床予測モデルを構築するためのコアモジュールです。

| 方法 | 説明 | 主な目的 |
| :--- | :--- | :--- |
| **C5: 解析的アプローチ (Riley)** | **ゴールドスタンダード。** 多変量モデル開発のための閉形式解。 | 1. グローバルシュリンク (shrinkage $S \ge 0.9$) を制限する。<br />2. 性能の楽観的バイアスを制限する。<br />3. 切片係数を正確に推定する。 |
| **C6: シミュレーションベースの設計** | 複雑なモデルの要件を推定するために、特定のデータ生成メカニズム (DGM) をシミュレートします。 | 非線形項、複雑な相互作用、特定の相関構造。 |
| **C7: ベイズ保証 (Assurance)** | 成功確率 (Assurance) が保証されたサンプルサイズを決定するためのMCMCベースのシミュレーション。 | ベイズモデル開発。 |

### D. 検証と更新

既存モデルの外部検証を計画するためのツール。

| 方法 | 説明 | 参考文献 |
| :--- | :--- | :--- |
| **D8: AUC 精度** | AUC (C統計量) の特定の信頼区間幅を達成するための N を計算します。 | **Hanley & McNeil (1982)** |
| **D9: カスタム検証サイズ** | O/E 比、キャリブレーションスロープ、および AUC の正確な推定を保証するための N を計算します。 | **Riley et al. (2021)** / `pmvalsampsize` |
| **D10: 検証シミュレーション** | 線形予測子 (LP) の分布を使用したシミュレーションベースの計画。 | **Snell et al. (2021)** |
| **D11: モデル更新** | 新しい環境に合わせて既存のモデル（切片/傾き）を更新（再キャリブレーション）するために必要なサンプルサイズ。 | **Van Calster et al.** |

---

## 3. インストールとローカル実行

このアプリケーションを独自のインフラストラクチャにデプロイするには：

### 前提条件

* Python 3.9 以上
* Git

### デプロイ手順

1. **リポジトリのクローン (Clone)**

   ```bash
   git clone https://github.com/nguyenminh2301/pmsample.git
   cd pmsample
   ```

2. **環境設定**
   仮想環境 (virtual environment) の使用を推奨します。

   ```bash
   python -m venv .venv
   # Windows:
   .venv\Scripts\activate
   # macOS/Linux:
   source .venv/bin/activate
   ```

3. **依存関係のインストール**

   ```bash
   pip install -r requirements.txt
   ```

4. **アプリの起動**

   ```bash
   streamlit run pmsampsize_app/app.py
   ```

---

## 4. 免責事項

**学術および研究目的のみ。**

本ソフトウェアは、査読付き文献で発表された統計手法の実装です。アルゴリズムの正確性を確保するためにあらゆる努力が払われていますが、著者および保守者は、このツールに基づく研究の設計または結果について一切の責任を負いません。

* **ユーザーの責任**: ユーザーは、入力パラメータを検証し、特定の臨床的文脈の中で結果を解釈する責任があります。
* **医療保証なし**: このツールは医学的アドバイスを提供するものではありません。

---

**著者 & 保守:**
Minh Nguyen (minhnt@ump.edu.vn)
Department of Epidemiology, Faculty of Public Health, University of Medicine and Pharmacy at Ho Chi Minh City, Vietnam
(Bộ môn Dịch tễ học, Khoa Y tế công cộng, Đại học Y Dược TP. Hồ Chí Minh, Việt Nam)
